# راهنمای پشتیبانی از Polylang برای ویدیوها

## خلاصه تغییرات

این به‌روزرسانی قابلیت پشتیبانی کامل از Polylang را برای پست‌تایپ `um_videos` و ویجت ویدیو اضافه کرده است.

## قابلیت‌های جدید

### 1. ثبت پست‌تایپ‌ها در Polylang
- پست‌تایپ `um_videos` در Polylang ثبت می‌شود
- تاکسونومی `um_video_category` در Polylang ثبت می‌شود
- امکان ایجاد ویدیوهای مجزا برای هر زبان

### 2. فیلتر خودکار بر اساس زبان
- ویجت ویدیو به طور خودکار ویدیوهای زبان فعلی را نمایش می‌دهد
- دسته‌بندی‌ها نیز بر اساس زبان فعلی فیلتر می‌شوند

### 3. بارگذاری پویا
- اگر ویدیویی در زبان فعلی وجود نداشته باشد، به طور خودکار از AJAX بارگذاری می‌شود
- پشتیبانی از تشخیص زبان از URL و متغیرهای JavaScript

## نحوه استفاده

### 1. ایجاد ویدیو برای زبان‌های مختلف

1. در پنل مدیریت، به بخش "مدیریت دانشگاه" > "ویدیوها" بروید
2. برای هر زبان، ویدیوهای مجزا ایجاد کنید
3. در Polylang، ویدیوها را به زبان‌های مختلف ترجمه کنید

### 2. تنظیم ویجت در المنتور

1. ویجت "مدیریت ویدیوها" را به صفحه اضافه کنید
2. در بخش "منبع ویدیوها"، "خودکار (از پست‌تایپ)" را انتخاب کنید
3. ویجت به طور خودکار ویدیوهای زبان فعلی را نمایش می‌دهد

### 3. تست عملکرد

1. سایت را در زبان فارسی باز کنید - ویدیوهای فارسی نمایش داده می‌شوند
2. زبان سایت را به انگلیسی تغییر دهید - ویدیوهای انگلیسی نمایش داده می‌شوند
3. زبان سایت را به عربی تغییر دهید - ویدیوهای عربی نمایش داده می‌شوند

## کدهای اضافه شده

### 1. ثبت در Polylang
```php
// در تابع register_post_types()
if (function_exists('pll_register_post_type')) {
    pll_register_post_type('um_videos');
}

if (function_exists('pll_register_taxonomy')) {
    pll_register_taxonomy('um_video_category');
}
```

### 2. فیلتر بر اساس زبان
```php
// در ویجت ویدیو
if (function_exists('pll_current_language')) {
    $current_lang = pll_current_language();
    if ($current_lang) {
        $args['lang'] = $current_lang;
    }
}
```

### 3. AJAX برای بارگذاری پویا
```php
// تابع جدید برای دریافت ویدیوها بر اساس زبان
public function get_videos_by_language($lang = null, $limit = 10) {
    // کد دریافت ویدیوها بر اساس زبان
}
```

## نکات مهم

1. **ضروری**: قبل از استفاده، اطمینان حاصل کنید که Polylang نصب و فعال است
2. **ترجمه**: برای هر زبان، ویدیوهای مجزا ایجاد کنید
3. **دسته‌بندی**: دسته‌بندی‌ها نیز باید برای هر زبان ترجمه شوند
4. **فال‌بک**: اگر ویدیویی در زبان فعلی وجود نداشته باشد، پیام مناسب نمایش داده می‌شود

## عیب‌یابی

### مشکل: ویدیوها نمایش داده نمی‌شوند
**راه حل:**
1. بررسی کنید که Polylang فعال است
2. اطمینان حاصل کنید که ویدیوها برای زبان فعلی ایجاد شده‌اند
3. لاگ‌های JavaScript را بررسی کنید

### مشکل: دسته‌بندی‌ها خالی هستند
**راه حل:**
1. دسته‌بندی‌ها را برای زبان فعلی ترجمه کنید
2. اطمینان حاصل کنید که تاکسونومی در Polylang ثبت شده است

### مشکل: AJAX کار نمی‌کند
**راه حل:**
1. بررسی کنید که nonce درست تنظیم شده است
2. اطمینان حاصل کنید که hook های AJAX اضافه شده‌اند
3. لاگ‌های PHP را بررسی کنید

## تغییرات فایل‌ها

### فایل‌های تغییر یافته:
1. `university-management.php` - اضافه کردن پشتیبانی Polylang
2. `includes/widgets/video-widget.php` - فیلتر بر اساس زبان
3. `assets/js/video-widget.js` - بارگذاری پویا بر اساس زبان

### فایل‌های جدید:
1. `Polylang-Video-README.md` - این فایل راهنما

## نسخه‌ها

- **نسخه فعلی**: 1.0.0
- **تاریخ**: 2025/08/04
- **سازگاری**: WordPress 5.0+, Polylang 3.0+ 