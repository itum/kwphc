# افزونه مدیریت دانشگاه برای وردپرس

این افزونه برای مدیریت اطلاعات دانشگاه، اخبار، تقویم و ویدئوهای آموزشی طراحی شده است.

## نصب و راه‌اندازی

### مرحله 1: نصب افزونه
1. فایل `kwprc-university-plugin-fixed.zip` را از پنل مدیریت وردپرس آپلود کنید
2. افزونه را فعال کنید
3. در منوی مدیریت، بخش "مدیریت دانشگاه" ایجاد می‌شود

### مرحله 2: آپلود اطلاعات
1. از منوی "ورود اطلاعات پایگاه داده" استفاده کنید
2. فایل SQL مربوط به اخبار را آپلود کنید
3. سیستم اطلاعات را به پست‌های وردپرس تبدیل می‌کند

### مرحله 3: تنظیمات تصاویر (اختیاری)
⚠️ **مهم**: این نسخه شامل تصاویر نیست تا حجم کمتری داشته باشد

برای اضافه کردن تصاویر:
1. تصاویر را در پوشه `wp-content/uploads/university-news/` قرار دهید
2. یا از بخش "ورود اطلاعات پایگاه داده" فایل SQL و تصاویر را آپلود کنید

## تغییرات نسخه 1.2.1 (بهبود یافته)

### مشکلات برطرف شده:
- ✅ رفع خطای "undefined index: is_important" در ویجت تقویم
- ✅ بهبود error handling در هنگام فعال‌سازی افزونه
- ✅ اضافه کردن بررسی‌های امنیتی بیشتر
- ✅ بهبود پیام‌های خطا و راهنمایی‌ها
- ✅ بررسی خودکار نیازمندی‌های سیستم

### ویژگی‌های جدید:
- 🔧 بررسی خودکار نسخه PHP (حداقل 7.0)
- 🔧 بررسی خودکار نسخه WordPress (حداقل 5.0)
- 🔧 ایجاد خودکار پوشه‌های مورد نیاز
- 🔧 پیام‌های خطای بهتر و راهنمایی‌های دقیق‌تر
- 🔧 بهبود سیستم لاگ گیری و عیب‌یابی

## ویژگی‌های افزونه

### 1. مدیریت اخبار
- تبدیل خودکار اخبار SQL به پست‌های وردپرس
- مدیریت کامنت‌ها و بازدیدها
- دسته‌بندی خودکار اخبار

### 2. ویجت‌های Elementor
- ویجت تقویم جلالی
- ویجت تایمر کلاس‌ها
- ویجت ویدئو

### 3. سیستم لاگ گیری
- ردیابی تمام عملیات آپلود
- مدیریت خطاها و مشکلات
- لاگ‌گیری جزئیات در فایل و دیتابیس

### 4. امنیت
- اعتبارسنجی کامل فایل‌ها
- محافظت CSRF
- تصفیه اطلاعات ورودی
- بررسی دسترسی‌های فایل

## نیازمندی‌های سیستم

### حداقل نیازمندی‌ها:
- PHP 7.0 یا بالاتر
- WordPress 5.0 یا بالاتر
- افزونه Elementor (برای استفاده از ویجت‌ها)
- حداقل 128MB RAM
- دسترسی نوشتن در پوشه wp-content

### توصیه شده:
- PHP 7.4 یا بالاتر
- WordPress 6.0 یا بالاتر
- 256MB RAM یا بیشتر
- SSL فعال

## استفاده از ویجت‌ها

### ویجت تقویم
```php
// افزودن رویداد جدید
$calendar_events = [
    [
        'event_date' => '2024-07-10',
        'event_title' => 'شروع ترم جدید',
        'is_important' => 'yes'
    ]
];
```

### ویجت تایمر کلاس
```php
// تنظیمات تایمر
$class_timer = [
    'start_time' => '09:00',
    'end_time' => '11:00',
    'class_name' => 'ریاضی پیشرفته'
];
```

## پیکربندی پیشرفته

### تنظیمات دیتابیس
```php
// در wp-config.php
define('UM_IMPORT_MAX_SIZE', 50 * 1024 * 1024); // 50MB
define('UM_IMPORT_TIMEOUT', 300); // 5 دقیقه
```

### تنظیمات لاگ
```php
// فعال کردن لاگ‌گیری پیشرفته
define('UM_DEBUG_MODE', true);
define('UM_LOG_LEVEL', 'all');
```

## عیب‌یابی

### مشکلات رایج

1. **خطای "undefined index: is_important"**
   - ✅ رفع شده در نسخه 1.2.1
   - مقدار پیش‌فرض 'no' تعیین شده

2. **افزونه فعال نمی‌شود**
   - بررسی نسخه PHP و WordPress
   - مطالعه پیام‌های خطا در dashboard
   - بررسی لاگ‌های خطا در cPanel

3. **آپلود ناموفق فایل**
   - بررسی حجم فایل (حداکثر 50MB)
   - فرمت فایل باید SQL باشد
   - بررسی دسترسی‌های فایل

4. **نمایش نامناسب تصاویر**
   - تصاویر را در مسیر صحیح قرار دهید
   - دسترسی‌های فایل را بررسی کنید
   - وجود پوشه wp-content/uploads/university-news/

### راهنمای تشخیص مشکل

1. **فعال کردن Debug Mode**
   ```php
   // در wp-config.php
   define('WP_DEBUG', true);
   define('WP_DEBUG_LOG', true);
   define('WP_DEBUG_DISPLAY', false);
   ```

2. **بررسی Error Logs**
   - پوشه `/wp-content/debug.log`
   - لاگ‌های سرور در cPanel
   - بخش "لاگ‌های عملیات" در افزونه

3. **چک کردن نیازمندی‌ها**
   - نسخه PHP: `<?php echo phpversion(); ?>`
   - نسخه WordPress: داشبورد → About WordPress
   - وضعیت Elementor: Plugins → Installed Plugins

### مسیرهای فایل

```
wp-content/
├── plugins/
│   └── kwprc-university-plugin/
│       ├── admin/
│       ├── assets/
│       ├── includes/
│       └── university-management.php
├── uploads/
│   └── university-news/
│       └── [تصاویر اخبار]
├── debug.log
└── um-import-log.txt
```

## API و Hook ها

### Actions
```php
// پس از آپلود موفق اطلاعات
do_action('um_after_import_success', $imported_data);

// پس از حذف اطلاعات
do_action('um_after_import_delete', $deleted_count);

// پس از فعال‌سازی افزونه
do_action('um_after_activation');
```

### Filters
```php
// تغییر تنظیمات آپلود
add_filter('um_import_settings', function($settings) {
    $settings['max_size'] = 100 * 1024 * 1024; // 100MB
    return $settings;
});

// تغییر پیام‌های خطا
add_filter('um_error_messages', function($messages) {
    $messages['custom_error'] = 'پیام خطای سفارشی';
    return $messages;
});
```

## پشتیبانی

در صورت بروز مشکل:
1. **بررسی نیازمندی‌ها**: نسخه PHP و WordPress
2. **فعال کردن Debug**: WP_DEBUG و بررسی لاگ‌ها
3. **تست تداخل**: غیرفعال کردن سایر افزونه‌ها
4. **بررسی Theme**: تست با theme پیش‌فرض WordPress
5. **مطالعه راهنماها**: فایل‌های راهنمای موجود در افزونه

### اطلاعات سیستم مورد نیاز برای پشتیبانی:
- نسخه PHP
- نسخه WordPress
- نسخه Elementor
- لیست افزونه‌های فعال
- محتوای فایل‌های لاگ

## نسخه‌بندی

**نسخه فعلی**: 1.2.4 (AJAX & Logs Fixed)
- رفع خطای "undefined index"
- بهبود error handling
- اضافه کردن بررسی‌های امنیتی
- بهبود سیستم لاگ‌گیری
- کاهش حجم فایل (بدون تصاویر)

## حق نشر

© 2024 - طراحی شده برای دانشگاه و مراکز آموزشی
ایجاد شده توسط منصور شوکت - farazec.com 